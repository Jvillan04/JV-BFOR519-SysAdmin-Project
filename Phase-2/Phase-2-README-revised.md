# Phase 2 - Adding Tailscale to Proxmox for Secure Remote Access

## What is Tailscale
Tailscale is a software tool that creates a private mesh network where all nodes can connect to each other. It lets you tunnel between devices on different networks as if they were on the same one. Tailscale runs on top of *WireGuard* and works through NATs and firewalls. I use it to connect to my home server running Proxmox and to the VMs on that server when I am away. It also lets me connect by DNS name instead of memorizing IP addresses (This DNS is local to devices in your Tailscale network, or tailnet. If you try that name on a device outside the tailnet it will not resolve)

## How it Works
### WireGuard
At the foundation of Tailscale is WireGuard. It is an open source tool that creates lightweight, encrypted tunnels between your devices (computers, VMs, containers, servers, Samsung Fridge, you name it). WireGuard runs over _UDP_ to prioritize speed and efficiency. UDP sends packets and does not check for missing ones, which keeps overhead low and helps with *NAT traversal*. Usually VPN users (including WireGuard users) use a _hub and spoke_ layout, where each client device (like your Samsung Fridge) connects to a central concentrator or VPN gateway before it can reach any other device on the VPN.
#### The traditional approach to VPNs (VPN concentrator / server) (Hub and Spoke Layout)
The main downside to this traditional approach is that the concentrator may be far from a client device, which adds latency. For example, if I am in NYC and need to reach a device in New Jersey, but the VPN concentrator is in Los Angeles, my traffic goes to Los Angeles first, then back to New Jersey, and the replies follow the same path. This adds significant latency.
#### What Tailscale does differently
Tailscale takes a different approach. Instead of a hub and spoke layout, it forms a mesh where hosts inside the tailnet (Tailscale network) connect directly to other hosts using WireGuard tunnels.

All of these hosts contact a Tailscale coordination server on the control plane, which is where tailnet hosts obtain asymmetric keys and peer information. The control plane does not carry your data traffic. Its job is to manage keys and share public keys between peers so they can create VPN tunnels. From there, hosts use those keys to talk to each other. It is a hybrid centralized model: key management is centralized, while the hosts communicate directly. You get the benefits of centralized administration without creating a bottleneck.
##### Encryption keys (what is the deal with these, and how does Tailscale use them?)
Tailscale uses asymmetric key pairs (public and private). Each node generates its own key pair and associates its public key with its identity. The node then contacts the coordination server, provides its public key, and announces where it is and which domain it belongs to. The node then receives a list of public keys and addresses for other nodes in the same domain. It uses this information to configure its WireGuard instance with the right peers. This design provides end to end encryption between Tailscale nodes and lines up with zero trust networking ideas.

**Note**: Only public keys are shared with the coordination servers (private keys stay with the host).

#### NAT Traversal
Tailscale uses NAT traversal to let two devices talk directly even when both sit behind NAT routers and firewalls, without any special router configuration. In other words, this is Tailscale’s way for getting through those edge devices since routers generally only let a packet back in if they’ve seen something go out first, each client fires off a few “probe” packets from the same UDP socket (ip:port combo) it will use for the VPN and swaps its public IP/port with peers via the control plane. Once both sides know where to aim, they send simultaneous packets to punch a tiny hole through the firewall and then switch to a fully encrypted WireGuard tunnel. In cases where a direct path isn’t possible, such as when I have my Proxmox server set up in my dorm room, Tailscale relays the encrypted traffic through its DERP servers until a direct path appears, so it can bypass any restrictions the college network may have preventing me from directly connecting to my Proxmox server.

#### Tailscale IP
Each device in your tailnet gets a stable 100.x.y.z address that stays the same wherever the device is. Tailscale picks these from the RFC6598 CGNAT range so they are unlikely to collide with common home or lab subnets like 10.0.0.0/8 or 192.168.0.0/24. These addresses are not on the public internet and they usually get NATed again when traffic leaves your tailnet. Every device can also reach a special service address called Quad100 (100.100.100.100) that Tailscale uses for things like internal DNS and discovery. For example, my Proxmox server gets a virtual NIC from Tailscale. Tailscale assigns it a Tailscale IP and every device in my tailnet can reach the server at that IP. Every device in my tailnet can also reach that Quad100 address too.
#### Tailscale DNS
Another neat feature of Tailscale is the ability to give your devices in your Tailnet a more human readable name via DNS instead of memorizing it's IP address. You get your own unique domain name for Tailscale where each machine in your Tailnet is automatically added upon registration and can be accessed by using it's \<hostname>.\<Tailscale domain name>. (ex: `server.example.com`)

## Other Features of Tailscale
### Subnet Routers
Say you have a device on your LAN you want to reach remotely, like a Cisco switch you want to configure, but it cannot run the Tailscale client. You can set one machine in your tailnet to act as a subnet router that advertises the subnet the Cisco switch is on to the rest of the tailnet. For example, my Proxmox server runs a Tailscale Linux container (LXC) that also acts as a subnet router. If I need to reach that Cisco switch, I connect securely to the LXC and it relays the traffic to the switch on the LAN. This gives you the benefits of remote administration for your network devices while staying secure.
### Exit Node
Another neat thing you can do with Tailscale is set up a device as an exit node. This helps when you are on insecure Wi-Fi, like at a cafe, and you do not want your internet traffic intercepted or read. You can tunnel to an exit node on your home network and have that node send your traffic out to the internet, essentially acting as your personal VPN server. I have this running in a Proxmox LXC for times when I need a secure connection and the only network I can use is public.
